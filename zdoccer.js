"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),e=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return a(t,e),t};Object.defineProperty(exports,"__esModule",{value:!0});var d=e(require("fs")),c=(f.prototype.resolveLinks=function(){for(var e=0,t=l.files;e<t.length;e++)t[e].resolveLinks()},f.prototype.write=function(){var e="This file was auto-generated with `zdoccer.js` "+f.version+"\n\n";e+="# Index\n\n";for(var t=0,n=l.files;t<n.length;t++)for(var r=0,a=n[t].headings;r<a.length;r++){var i=a[r];e+="  ".repeat(i.level)+"- ["+i.text+"](#"+i.id+")\n"}console.log("files docced:",l.files.length);for(var s=0,o=l.files;s<o.length;s++)e+=o[s].getContent();d.writeFileSync("README.md",e)},f.version="1.3.0",f.javadocExtensions=["ts","js","php","css","scss"],f.markdownExtensions=["md"],f.ignores=["*/polyfills.ts","*/e2e/*"],f.ignoresRegex=[],f.mangles=["^export "," implements .*"],f.manglesRegex=[],f);function f(){var e=this,t=process.argv.slice(2),n=t[0];if(d.statSync(n).isDirectory()){t.splice(0,1);for(var r=0,a=t;r<a.length;r++){var i=a[r];(i=i.replace(/([-+]\w+)=(.*)/,function(e,t,n){return"+i"===t?(f.ignores.push(n),""):e}))&&console.log("could not understand argument: "+i)}console.log("running ZDoccer "+f.version);for(var s=0,o=f.ignores;s<o.length;s++){var l=o[s];l="^"+(l=(l=(l=l.replace(/\//g,"\\/")).replace(/\./g,"\\.")).replace(/\*/g,".*"))+"$",f.ignoresRegex.push(new RegExp(l))}for(var c=0,p=f.mangles;c<p.length;c++){var u=p[c];f.manglesRegex.push(new RegExp(u))}var h=new v(n);h.isReady().then(function(){h.doc(),e.resolveLinks(),e.write()})}else console.log("invalid root path")}var v=(p.prototype.isReady=function(){return this._ready},p.prototype.scan=function(){var s=this,o=[],l=[];return new Promise(function(i,e){d.readdir(s.path,function(e,t){for(var n=0,r=t;n<r.length;n++){var a=r[n],a=new p(s.path+"/"+a);o.push(a),l.push(a.isReady())}Promise.all(l).then(function(){o.sort(function(e,t){return e.stats.isFile()!=t.stats.isFile()?+t.stats.isFile()-+e.stats.isFile():e.path.toLowerCase()>t.path.toLowerCase()?1:-1}),s.children=o,i()})})})},p.prototype.doc=function(){if(this.stats.isFile()){for(var e=0,t=c.ignoresRegex;e<t.length;e++){var n=t[e];if(this.path.match(n))return}var r=this.path.match(/\.([\w\d]+)$/),r=r?r[1]:"";c.javadocExtensions.includes(r)?new o(this.path):c.markdownExtensions.includes(r)&&new u(this.path)}else if(this.stats.isDirectory())for(var a=0,i=this.children||[];a<i.length;a++)i[a].doc()},p);function p(e){var r=this;this.path=e,this.stats=new d.Stats,this._ready=new Promise(function(n,e){d.stat(r.path,function(e,t){r.stats=t,r.stats.isFile()?n():r.scan().then(function(){n()})})})}var l=(g.prototype.resolveLinks=function(){var d=this;this.markdown=this.markdown.replace(/(\[\[.*?\]\])(\(.+?\))?/g,function(e,t,n){var r=t;r=(r=(r=r.trim()).replace(/^\[\[/,"")).replace(/\]\]$/,"");function a(e,t){for(var n=0,r=e;n<r.length;n++){var a=r[n],i=0;o==a.id||o==a.alias&&s?i=100:a.id.match(l)&&(i=t),c<i?(c=i,p=a):100==i&&i==c&&(u=u||[p]).push(a)}}var t=n||r,s=!n,o=m.createId(t),l=new RegExp("\\b"+o+"\\b"),c=0,p=void 0,u=null;if(a(d.headings,2),c<100)for(var i=0,h=g.files;i<h.length;i++)a(h[i].headings,1);t="**&#x1f875;**";return p?c<100?(console.warn("weakly resolved link:",e),t="**?**"):u&&(console.warn("ambiguous link:",e),t="**&#x26a0;**"):(console.warn("could not resolve link:",e),t="**&#x29b8;**"),"["+r+" "+t+"](#"+(p?p.id:"")+")"})},g.prototype.getContent=function(){return this.markdown},g.files=[],g);function g(e,t,n){var i=this;this.headings=[],this.path=e,t=t.replace(/^(\#+)(\(([\w-]+)\))?[ \t]+(.*)$/gm,function(e,t,n,r,a){r=new m(a,t.length,r);return i.headings.push(r),'<div id="'+r.id+'"></div>\x3c!-- alias: '+r.alias+" --\x3e\n\n"+t+" "+r.text}),this.markdown="\n\n---\n\n*"+n+" from "+e+"*\n\n"+t,g.files.push(this)}var m=(s.createId=function(e){e=e.toLowerCase();return e=(e=(e=e.replace(/[^a-z0-9]+/g,"-")).replace(/^-/,"")).replace(/-$/,"")},s.ids=[],s);function s(e,t,n){this.level=t,this.text=e.trim();for(var r=s.createId(this.text),a=r,i=1;-1<s.ids.indexOf(a);)a=r+"--"+ ++i;this.id=a,this.alias=n||this.id,s.ids.push(this.id)}var o=(t.prototype.docMatch=function(e){var t=e[1],n=void 0;t=(t=(t=(t=(t=(t=(t=(t=t.replace(/^[ \t]*\/\*\*[ \t]*/,"")).replace(/[ \t]*\*\/[ \t]*$/,"")).replace(/^[ \t]*\* /gm,"")).replace(/^(#+)[ \t]*/,function(e,t){return n=t.length,""})).replace(/^\@param\s+(\w+)\s+(.*)/gm,function(e,t,n){return"- *param* `"+t+"` &mdash; "+n})).replace(/^\@binding\s+(\S+)\s+(.*)/gm,function(e,t,n){return"- *binding* `"+t+"` &mdash; "+n})).replace(/^\@slot\s+(\S+)\s+(.*)/gm,function(e,t,n){return"- *slot* `"+t+"` &mdash; "+n})).replace(/^\@(\w+)\s+(.*)/gm,function(e,t,n){return"- *"+t+"* &mdash; "+n});var r="";if(""!=(o=e[2]).trim()){var a=0;n?a=n:(a=2,o=o.replace(/^(  |\t)/g,function(e){return a++,""})),o=(o=(o=o.replace(/^\s*/,"")).replace(/\s*[{;]?$/,"")).replace(/^\/\/doc\s*/,"");for(var i=0,s=c.manglesRegex;i<s.length;i++){var o,l=s[i];o=(o=o.replace(l,"")).trim()}e=o;e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=e.replace(/:.*/,"")).replace(/\(.*/,"")).replace(/\?.*/,"")).replace(/<.*/,"")).replace(/^export /,"")).replace(/^public /,"")).replace(/^private /,"")).replace(/^static /,"")).replace(/^readonly /,"")).replace(/^abstract /,"")).replace(/^class /,"")).replace(/^function /,"")).replace(/^interface /,"")).replace(/^const /,"")).replace(/^enum /,"")).replace(/ implements .*/,"")).replace(/ extends .*/,""),e=m.createId(e),r+="#".repeat(a)+"("+e+") `"+o+"`\n\n"}return r+=t,r+="\n\n"},t);function t(e){for(var t,n="",r=d.readFileSync(e,"utf8"),a=/(^[ \t]*\/\*\*#*[\S\s]*?\*\/)(?:\r\n|\r|\n)([^\r\n]*)/gm;(t=a.exec(r))&&(n+=this.docMatch(t)),null!=t;);""!=n&&new l(e,n,"transformed Javadoc")}var u=function(e){var t=d.readFileSync(e,"utf8");""!=t&&new l(e,t,"original Markdown")};new c;